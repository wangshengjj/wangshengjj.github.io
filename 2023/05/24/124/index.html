<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>【Linux安全系列教程】iptables防火墙 | WangShengJJのblog</title><meta name="author" content="网笙久久"><meta name="copyright" content="网笙久久"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="【Linux安全系列教程】iptables防火墙 下一期教程：Firewalld防火墙  一、防火墙的类型 硬件防火墙 软件防火墙 netfilter内核模块  Centos7.x firewall-cmd命令 firewalld服务 iptables命令    二、防火墙的作用 数据过滤 根据数据基本五元素 源IP、目的IP、协议、源端口、目的端口      三、关于四表五链 1.filler表">
<meta property="og:type" content="article">
<meta property="og:title" content="【Linux安全系列教程】iptables防火墙">
<meta property="og:url" content="https://blog.wangshengjj.work/2023/05/24/124/index.html">
<meta property="og:site_name" content="WangShengJJのblog">
<meta property="og:description" content="【Linux安全系列教程】iptables防火墙 下一期教程：Firewalld防火墙  一、防火墙的类型 硬件防火墙 软件防火墙 netfilter内核模块  Centos7.x firewall-cmd命令 firewalld服务 iptables命令    二、防火墙的作用 数据过滤 根据数据基本五元素 源IP、目的IP、协议、源端口、目的端口      三、关于四表五链 1.filler表">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dmoe.cc/random.php">
<meta property="article:published_time" content="2023-05-24T05:36:24.144Z">
<meta property="article:modified_time" content="2023-05-29T08:09:58.749Z">
<meta property="article:author" content="网笙久久">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="centos">
<meta property="article:tag" content="centos7">
<meta property="article:tag" content="iptables">
<meta property="article:tag" content="linux防火墙">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.dmoe.cc/random.php"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.wangshengjj.work/2023/05/24/124/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【Linux安全系列教程】iptables防火墙',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-29 16:09:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><meting-js server="netease" type="playlist" id="7386208265" lrc-type="0" volume="0.5" fixed="true" mini="true" order="random" loop="all" autoplay="true" preload="auto" list-folded="true"></meting-js><script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body><link rel="stylesheet" href="/css/barber-shop.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/medias/loading.gif" data-original="https://www.wangshengjj.work/upload/2022/10/touxiang.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">185</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">261</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 博客主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.wangshengjj.work/"><i class="fa-fw fa fa-rss"></i><span> 主博客</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://cloud.wangshengjj.work/"><i class="fa-fw fa fa-cloud"></i><span> 云盘</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://start.wangshengjj.work/"><i class="fa-fw fa fa-paper-plane"></i><span> 起始页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://space.bilibili.com/219606508/bangumi/"><i class="fa-fw fas fa-video"></i><span> 我的追番</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://home.wangshengjj.work/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://vme50.wangshengjj.work/"><i class="fa-fw fas fa-music"></i><span> V我50</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.dmoe.cc/random.php')"><nav id="nav"><span id="blog-info"><a href="/" title="WangShengJJのblog"><span class="site-name">WangShengJJのblog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 博客主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.wangshengjj.work/"><i class="fa-fw fa fa-rss"></i><span> 主博客</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://cloud.wangshengjj.work/"><i class="fa-fw fa fa-cloud"></i><span> 云盘</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://start.wangshengjj.work/"><i class="fa-fw fa fa-paper-plane"></i><span> 起始页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://space.bilibili.com/219606508/bangumi/"><i class="fa-fw fas fa-video"></i><span> 我的追番</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://home.wangshengjj.work/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://vme50.wangshengjj.work/"><i class="fa-fw fas fa-music"></i><span> V我50</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【Linux安全系列教程】iptables防火墙</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-24T05:36:24.144Z" title="发表于 2023-05-24 13:36:24">2023-05-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-29T08:09:58.749Z" title="更新于 2023-05-29 16:09:58">2023-05-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/Linux%E5%AE%89%E5%85%A8/">Linux安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/Linux%E5%AE%89%E5%85%A8/%E9%98%B2%E7%81%AB%E5%A2%99/">防火墙</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/Linux%E5%AE%89%E5%85%A8/%E9%98%B2%E7%81%AB%E5%A2%99/iptables%E9%98%B2%E7%81%AB%E5%A2%99/">iptables防火墙</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【Linux安全系列教程】iptables防火墙"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="【Linux安全系列教程】iptables防火墙"><a href="#【Linux安全系列教程】iptables防火墙" class="headerlink" title="【Linux安全系列教程】iptables防火墙"></a>【Linux安全系列教程】iptables防火墙</h1><blockquote>
<p><strong>下一期教程：<a target="_blank" rel="noopener" href="https://www.wsjj.top/archives/125">Firewalld防火墙</a></strong></p>
</blockquote>
<h2 id="一、防火墙的类型"><a href="#一、防火墙的类型" class="headerlink" title="一、防火墙的类型"></a>一、防火墙的类型</h2><ul>
<li>硬件防火墙</li>
<li>软件防火墙<ul>
<li><code>netfilter</code>内核模块 </li>
<li><code>Centos7.x</code> <code>firewall-cmd命令</code> <code>firewalld服务</code></li>
<li><code>iptables</code>命令</li>
</ul>
</li>
</ul>
<h2 id="二、防火墙的作用"><a href="#二、防火墙的作用" class="headerlink" title="二、防火墙的作用"></a>二、防火墙的作用</h2><ul>
<li>数据过滤<ul>
<li>根据数据基本五元素<ul>
<li><code>源IP</code>、<code>目的IP</code>、<code>协议</code>、<code>源端口</code>、<code>目的端口</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="三、关于四表五链"><a href="#三、关于四表五链" class="headerlink" title="三、关于四表五链"></a>三、关于四表五链</h2><p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall01.png" alt="wall01"></p>
<h3 id="1-filler表中的链"><a href="#1-filler表中的链" class="headerlink" title="1.filler表中的链"></a>1.filler表中的链</h3><blockquote>
<p><strong><code>INPUT</code>、<code>FORWARD</code>、<code>OUTPUT</code></strong></p>
</blockquote>
<h3 id="2-NAT表中的链"><a href="#2-NAT表中的链" class="headerlink" title="2.NAT表中的链"></a>2.NAT表中的链</h3><blockquote>
<p><strong><code>PREROUTING</code>、<code>INPUT</code>、<code>OUTPUT</code>、<code>POSTROUTING</code></strong></p>
</blockquote>
<h3 id="3-mangle表中的链"><a href="#3-mangle表中的链" class="headerlink" title="3.mangle表中的链"></a>3.mangle表中的链</h3><blockquote>
<p><strong><code>PREROUTING</code>、<code>INPUT</code>、<code>FORWARD</code>、<code>OUTPUT</code>、<code>POSTROUTING</code></strong></p>
</blockquote>
<h3 id="4-raw表中的链"><a href="#4-raw表中的链" class="headerlink" title="4.raw表中的链"></a>4.raw表中的链</h3><blockquote>
<p><strong><code>PREROUTING</code>、<code>OUTPUT</code></strong></p>
</blockquote>
<h3 id="编写规则注意事项"><a href="#编写规则注意事项" class="headerlink" title="编写规则注意事项"></a>编写规则注意事项</h3><ul>
<li>自上而下，依次匹配<ul>
<li>允许在要拒绝上面</li>
<li>访问频率高的服务规则尽量放在上面</li>
</ul>
</li>
<li>链的默认行为</li>
</ul>
<h2 id="四、数据过滤规则管理-filter表"><a href="#四、数据过滤规则管理-filter表" class="headerlink" title="四、数据过滤规则管理(filter表)"></a>四、数据过滤规则管理(filter表)</h2><h3 id="1-关闭防火墙"><a href="#1-关闭防火墙" class="headerlink" title="1.关闭防火墙"></a>1.关闭防火墙</h3><blockquote>
<p><strong><code>Centos7</code>有<code>2</code>个防火墙，一个现在的<code>iptables</code>，还有一个是基于<code>firewalld</code>服务的<code>firewall</code>防火墙</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# systemctl stop firewalld
[root@node4 ~]# systemctl disable firewalld
[root@node4 ~]# systemctl mask firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="2-查看防火墙规则"><a href="#2-查看防火墙规则" class="headerlink" title="2.查看防火墙规则"></a>2.查看防火墙规则</h3><h4 id="A-查看规则"><a href="#A-查看规则" class="headerlink" title="A.查看规则"></a>A.查看规则</h4><blockquote>
<p><strong><code>-L</code>列出规则</strong><br><strong><code>-n</code>以阿拉伯数字显示</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL
Chain INPUT (policy ACCEPT)	#防火墙默认规则，允许所有通过
target     prot opt source               destination         
#默认是没有规则的
Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="t-lt-表名-gt-查看指定表规则"><a href="#t-lt-表名-gt-查看指定表规则" class="headerlink" title="-t&lt;表名&gt;查看指定表规则"></a><code>-t&lt;表名&gt;</code>查看指定表规则</h4><blockquote>
<p><strong>如果不加<code>-t</code>参数，默认查看的是<code>filter表</code></strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL -t nat
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="line-number显示行号"><a href="#line-number显示行号" class="headerlink" title="--line-number显示行号"></a><code>--line-number</code>显示行号</h4><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL -t filter -v --line-number
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1     4247  374K ACCEPT     tcp  --  *      *       192.168.140.1        192.168.140.14       tcp dpt:22
2        0     0 DROP       all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 4028 packets, 647K bytes)
num   pkts bytes target     prot opt in     out     source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="v查看详细信息"><a href="#v查看详细信息" class="headerlink" title="-v查看详细信息"></a><code>-v</code>查看详细信息</h4><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL -t nat -v
Chain PREROUTING (policy ACCEPT 56 packets, 3092 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain INPUT (policy ACCEPT 8 packets, 424 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 216 packets, 16757 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 216 packets, 16757 bytes)
 pkts bytes target     prot opt in     out     source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-删除规则"><a href="#3-删除规则" class="headerlink" title="3.删除规则"></a>3.删除规则</h3><h4 id="A-删除单条规则"><a href="#A-删除单条规则" class="headerlink" title="A.删除单条规则"></a>A.删除单条规则</h4><h5 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h5><pre class="line-numbers language-none"><code class="language-none"># iptables -D 链名 行号<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="查看所有规则"><a href="#查看所有规则" class="headerlink" title="查看所有规则"></a>查看所有规则</h5><blockquote>
<p><strong>我这里加了<code>2</code>条测试规则</strong><br><strong>可以添加<code>--line-number</code>参数，显示行号</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL -t filter -v --line-number
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1     4247  374K ACCEPT     tcp  --  *      *       192.168.140.1        192.168.140.14       tcp dpt:22
2        0     0 DROP       all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 4028 packets, 647K bytes)
num   pkts bytes target     prot opt in     out     source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="例：我想删除第2条数据"><a href="#例：我想删除第2条数据" class="headerlink" title="例：我想删除第2条数据"></a>例：我想删除第2条数据</h5><blockquote>
<p><strong>如果不添加<code>-t</code>参数，默认删除<code>filter</code>表中的规则</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -D INPUT 2
[root@node4 ~]# iptables -D INPUT 2	#这是另外一种写法<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="查看规则"><a href="#查看规则" class="headerlink" title="查看规则"></a>查看规则</h5><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL -t filter -v --line-number

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1     7339  647K ACCEPT     tcp  --  *      *       192.168.140.1        192.168.140.14       tcp dpt:22

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 72 packets, 12372 bytes)
num   pkts bytes target     prot opt in     out     source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="B-删除所有规则"><a href="#B-删除所有规则" class="headerlink" title="B.删除所有规则"></a>B.删除所有规则</h4><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -F<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="查看规则-1"><a href="#查看规则-1" class="headerlink" title="查看规则"></a>查看规则</h5><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
#表中没有规则了
Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-添加规则"><a href="#4-添加规则" class="headerlink" title="4.添加规则"></a>4.添加规则</h3><h4 id="A-命令格式"><a href="#A-命令格式" class="headerlink" title="A.命令格式"></a>A.命令格式</h4><blockquote>
<p><strong>如果不写<code>-t</code>参数&#x3D;&#x3D;指定表名&#x3D;&#x3D;，默认添加到<code>filter</code>表中</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none"># iptables -t &lt;表名&gt; &#123;-A|-I&#125; &lt;链名&gt; [匹配数据的条件] -j &lt;行为&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p><strong><code>iptables</code>规则查询有默认的策略</strong><br><strong>从写的<code>第一条</code>匹配规则开始，一直<code>向后</code>匹配。</strong><br><strong>如果从<code>第一条</code>开始就<code>匹配到了</code>相应的规则，那么<code>后面</code>的规则都<code>不会继续</code>匹配，而是直接<code>应用第一条</code>规则，所以<code>合理</code>的规则是必要的！</strong></p>
</blockquote>
<ul>
<li><code>-A</code>新的规则连续向后插入，也就是会插入到已有规则的后面</li>
<li><code>-I</code>新的规则永远插入到第一个，当然<code>-I</code>参数也可以指定你想插入到哪一行</li>
</ul>
<h5 id="行为"><a href="#行为" class="headerlink" title="行为"></a>行为</h5><ul>
<li><code>ACCEPT</code>允许</li>
<li><code>DROP</code>拒绝</li>
<li><code>REJECT</code>拒绝</li>
</ul>
<h5 id="匹配数据条件的常用选项"><a href="#匹配数据条件的常用选项" class="headerlink" title="匹配数据条件的常用选项"></a>匹配数据条件的常用选项</h5><ul>
<li><code>-s</code>源<code>IP</code>地址<ul>
<li><code>-s 192.168.1.1</code>单独的<code>IP</code></li>
<li><code>-s 192.168.1.0/24</code>网段</li>
<li><code>!  -s 192.168.2.1</code>取反</li>
</ul>
</li>
<li><code>-d</code>目的<code>IP</code>地址<ul>
<li><code>-d 10.1.1.1</code></li>
<li><code>-d 10.1.1.0/24</code></li>
<li><code>!  -d 10.1.1.1</code></li>
</ul>
</li>
<li><code>-i</code>流入网卡<ul>
<li><code>-i ens33</code>网卡名</li>
</ul>
</li>
<li><code>-o</code>流出网卡<ul>
<li><code>-o ens33</code></li>
</ul>
</li>
<li><code>-p &#123;tcp|udp|icmp&#125;</code>#icmp用于授权ping<ul>
<li><code>--sport</code>源端口<ul>
<li><code>--sport 22</code></li>
<li><code>--sport 22:80</code>连续的端口</li>
</ul>
</li>
<li><code>--dport</code>目的端口<ul>
<li><code>--dport 80</code></li>
<li><code>--dport 80:3306</code>连续的端口</li>
</ul>
</li>
<li><code>--icmp-type &#123;8|0&#125;</code><ul>
<li><code>8</code>: <code>ping请求</code></li>
<li><code>0</code>: <code>ping响应</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="B-几个例子"><a href="#B-几个例子" class="headerlink" title="B.几个例子"></a>B.几个例子</h4><h5 id="a-仅允许Windows访问服务器上的ssh服务，并且拒绝其他所有服务"><a href="#a-仅允许Windows访问服务器上的ssh服务，并且拒绝其他所有服务" class="headerlink" title="a.仅允许Windows访问服务器上的ssh服务，并且拒绝其他所有服务"></a>a.仅允许<code>Windows</code>访问服务器上的<code>ssh</code>服务，并且拒绝其他所有服务</h5><blockquote>
<p><strong>我的<code>windows</code>地址是<code>192.168.140.1</code>，众所周知<code>SSH</code>服务依靠<code>TCP</code>协议的<code>22</code>号端口</strong><br><strong>关于<code>SSH</code>服务的教程：<a target="_blank" rel="noopener" href="https://www.wsjj.top/archives/58">https://www.wsjj.top/archives/58</a></strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -A INPUT -s 192.168.140.1 -d 192.168.140.14 -p tcp --dport 22 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p><strong>拒绝所有服务，不需要指定源<code>IP</code>和目的<code>IP</code>，也不需要指定协议和端口</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -A INPUT -j DROP	#执行这条命令有风险，请确认上面的规则完全匹配你的环境<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p><strong>可以看到<code>2</code>条已经生效的规则</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  192.168.140.1        192.168.140.14       tcp dpt:22
DROP       all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="测试其他机器能否通过SSH连接服务器"><a href="#测试其他机器能否通过SSH连接服务器" class="headerlink" title="测试其他机器能否通过SSH连接服务器"></a>测试其他机器能否通过<code>SSH</code>连接服务器</h6><pre class="line-numbers language-none"><code class="language-none">[root@node5 ~]# ssh root@192.168.140.14
^C	#可以看到无法建立连接<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="b-仅允许Windows可以ping通服务器，拒绝其他连接"><a href="#b-仅允许Windows可以ping通服务器，拒绝其他连接" class="headerlink" title="b.仅允许Windows可以ping通服务器，拒绝其他连接"></a>b.仅允许<code>Windows</code>可以<code>ping</code>通服务器，拒绝其他连接</h5><blockquote>
<p><strong><code>-I&lt;链名&gt; 行号</code>用于插入规则到指定行数</strong><br><strong><code>--icmp-type &#123;8|0&#125;</code></strong><br><strong><code>8</code>: <code>ping请求</code></strong><br><strong><code>0</code>: <code>ping响应</code></strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT 2 -s 192.168.140.1 -d 192.168.140.14 -p icmp --icmp-type 8 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="查询规则"><a href="#查询规则" class="headerlink" title="查询规则"></a>查询规则</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  192.168.140.1        192.168.140.14       tcp dpt:22
ACCEPT     icmp --  192.168.140.1        192.168.140.14       icmptype 8
DROP       all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Windows测试"><a href="#Windows测试" class="headerlink" title="Windows测试"></a><code>Windows</code>测试</h6><blockquote>
<p><strong>在添加规则之前，<code>Widnows</code>是无法<code>ping</code>通服务器的</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">C:\Users\wangshengjj&gt;ping 192.168.140.14

正在 Ping 192.168.140.14 具有 32 字节的数据:
来自 192.168.140.14 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64
来自 192.168.140.14 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64
来自 192.168.140.14 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64
来自 192.168.140.14 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="c-允许服务器ping通其他主机，而其他主机-比如Windows-无法ping通服务器"><a href="#c-允许服务器ping通其他主机，而其他主机-比如Windows-无法ping通服务器" class="headerlink" title="c.允许服务器ping通其他主机，而其他主机(比如Windows)无法ping通服务器"></a>c.允许服务器<code>ping</code>通其他主机，而其他主机(比如Windows)无法<code>ping</code>通服务器</h5><h6 id="删除之前的ping规则"><a href="#删除之前的ping规则" class="headerlink" title="删除之前的ping规则"></a>删除之前的<code>ping</code>规则</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -D INPUT 2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="新增规则"><a href="#新增规则" class="headerlink" title="新增规则"></a>新增规则</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT 2 -d 192.168.140.14 -p icmp --icmp-type 0 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Windows测试-1"><a href="#Windows测试-1" class="headerlink" title="Windows测试"></a><code>Windows</code>测试</h6><pre class="line-numbers language-none"><code class="language-none">C:\Users\wangshengjj&gt;ping 192.168.140.14

正在 Ping 192.168.140.14 具有 32 字节的数据:
请求超时。
请求超时。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="服务器这边测试"><a href="#服务器这边测试" class="headerlink" title="服务器这边测试"></a>服务器这边测试</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# ping 192.168.140.1
PING 192.168.140.1 (192.168.140.1) 56(84) bytes of data.
64 bytes from 192.168.140.1: icmp_seq&#x3D;1 ttl&#x3D;128 time&#x3D;0.104 ms
64 bytes from 192.168.140.1: icmp_seq&#x3D;2 ttl&#x3D;128 time&#x3D;0.144 ms
64 bytes from 192.168.140.1: icmp_seq&#x3D;3 ttl&#x3D;128 time&#x3D;0.159 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="d-要求能ping通自己"><a href="#d-要求能ping通自己" class="headerlink" title="d.要求能ping通自己"></a>d.要求能<code>ping</code>通自己</h5><blockquote>
<p><strong>以目前的规则来说，我们是无法<code>ping</code>通自己的</strong></p>
</blockquote>
<h6 id="添加规则"><a href="#添加规则" class="headerlink" title="添加规则"></a>添加规则</h6><blockquote>
<p><strong>指定网卡为<code>io</code></strong><br><strong><code>Centos7</code>中，<code>io</code>网卡为自己和自己通信的时候会用到</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT 2 -i lo -p icmp -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="查看所有规则-1"><a href="#查看所有规则-1" class="headerlink" title="查看所有规则"></a>查看所有规则</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -nL -v --line-number
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1    42850 3781K ACCEPT     tcp  --  *      *       192.168.140.1        192.168.140.14       tcp dpt:22
2        6   504 ACCEPT     icmp --  lo     *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           
3        6   504 ACCEPT     icmp --  *      *       0.0.0.0&#x2F;0            192.168.140.14       icmptype 0
4       91  7300 DROP       all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="ping测试"><a href="#ping测试" class="headerlink" title="ping测试"></a><code>ping</code>测试</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# ping 192.168.140.14
PING 192.168.140.14 (192.168.140.14) 56(84) bytes of data.
64 bytes from 192.168.140.14: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.015 ms
64 bytes from 192.168.140.14: icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;0.025 ms
64 bytes from 192.168.140.14: icmp_seq&#x3D;3 ttl&#x3D;64 time&#x3D;0.026 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# ping 127.0.0.1
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.015 ms
64 bytes from 127.0.0.1: icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;0.061 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="e-要求服务器可以正常上网，比如访问baidu"><a href="#e-要求服务器可以正常上网，比如访问baidu" class="headerlink" title="e.要求服务器可以正常上网，比如访问baidu"></a>e.要求服务器可以正常上网，比如访问<code>baidu</code></h5><blockquote>
<p><strong>以目前的规则，服务器是无法正常<code>ping</code>通互联网服务器的，并且无法正常上网</strong></p>
</blockquote>
<h6 id="添加规则，先能ping通"><a href="#添加规则，先能ping通" class="headerlink" title="添加规则，先能ping通"></a>添加规则，先能<code>ping</code>通</h6><blockquote>
<p><strong>众所周知，我们服务器想要<code>ping</code>通互联网上某个域名，需要依靠<code>DNS</code>服务器把域名转换成公网地址</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -p udp --sport 53 -j ACCEPT
[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -p tcp --sport 53 -j ACCEPT	#有一部分DNS服务器基于TCP服务<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h6 id="测试ping通baidu"><a href="#测试ping通baidu" class="headerlink" title="测试ping通baidu"></a>测试<code>ping</code>通<code>baidu</code></h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# ping baidu.com
PING baidu.com (39.156.66.10) 56(84) bytes of data.
64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq&#x3D;1 ttl&#x3D;128 time&#x3D;7.16 ms
64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq&#x3D;2 ttl&#x3D;128 time&#x3D;6.78 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="继续添加规则，用于访问web服务"><a href="#继续添加规则，用于访问web服务" class="headerlink" title="继续添加规则，用于访问web服务"></a>继续添加规则，用于访问<code>web</code>服务</h6><blockquote>
<p><strong>开放源端口<code>80</code>和<code>443</code>端口的访问</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -p tcp --sport 80 -j ACCEPT
[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -p tcp --sport 443 -j ACCEP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h6 id="使用curl命令测试"><a href="#使用curl命令测试" class="headerlink" title="使用curl命令测试"></a>使用<code>curl</code>命令测试</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# curl www.baidu.com	#正常访问

&lt;!DOCTYPE html&gt;
&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv&#x3D;content-type content&#x3D;text&#x2F;html;charset&#x3D;utf-8&gt;&lt;meta http-equiv&#x3D;X-UA-Compatible content&#x3D;IE&#x3D;Edge&gt;&lt;meta content&#x3D;always name&#x3D;referrer&gt;&lt;link rel&#x3D;stylesheet type&#x3D;text&#x2F;css href&#x3D;http:&#x2F;&#x2F;s1.bdstatic.com&#x2F;r&#x2F;www&#x2F;cache&#x2F;bdorz&#x2F;baidu.min.css&gt;&lt;title&gt;百度一下，你就知道&lt;&#x2F;title&gt;&lt;&#x2F;head&gt; &lt;body link&#x3D;#0000cc&gt; &lt;div id&#x3D;wrapper&gt; &lt;div id&#x3D;head&gt; &lt;div class&#x3D;head_wrapper&gt; &lt;div class&#x3D;s_form&gt; &lt;div class&#x3D;s_form_wrapper&gt; &lt;div id&#x3D;lg&gt; &lt;img hidefocus&#x3D;true src&#x3D;&#x2F;&#x2F;www.baidu.com&#x2F;img&#x2F;bd_logo1.png width&#x3D;270 height&#x3D;129&gt; &lt;&#x2F;div&gt; &lt;form id&#x3D;form name&#x3D;f action&#x3D;&#x2F;&#x2F;www.baidu.com&#x2F;s class&#x3D;fm&gt; &lt;input type&#x3D;hidden name&#x3D;bdorz_come value&#x3D;1&gt; &lt;input type&#x3D;hidden name&#x3D;ie value&#x3D;utf-8&gt; &lt;input type&#x3D;hidden name&#x3D;f value&#x3D;8&gt; &lt;input type&#x3D;hidden name&#x3D;rsv_bp value&#x3D;1&gt; &lt;input type&#x3D;hidden name&#x3D;rsv_idx value&#x3D;1&gt; &lt;input type&#x3D;hidden name&#x3D;tn value&#x3D;baidu&gt;&lt;span class&#x3D;&quot;bg s_ipt_wr&quot;&gt;&lt;input id&#x3D;kw name&#x3D;wd class&#x3D;s_ipt value maxlength&#x3D;255 autocomplete&#x3D;off autofocus&gt;&lt;&#x2F;span&gt;&lt;span class&#x3D;&quot;bg s_btn_wr&quot;&gt;&lt;input type&#x3D;submit id&#x3D;su value&#x3D;百度一下 class&#x3D;&quot;bg s_btn&quot;&gt;&lt;&#x2F;span&gt; &lt;&#x2F;form&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div id&#x3D;u1&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;news.baidu.com name&#x3D;tj_trnews class&#x3D;mnav&gt;新闻&lt;&#x2F;a&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;www.hao123.com name&#x3D;tj_trhao123 class&#x3D;mnav&gt;hao123&lt;&#x2F;a&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;map.baidu.com name&#x3D;tj_trmap class&#x3D;mnav&gt;地图&lt;&#x2F;a&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;v.baidu.com name&#x3D;tj_trvideo class&#x3D;mnav&gt;视频&lt;&#x2F;a&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;tieba.baidu.com name&#x3D;tj_trtieba class&#x3D;mnav&gt;贴吧&lt;&#x2F;a&gt; &lt;noscript&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;bdorz&#x2F;login.gif?login&amp;tpl&#x3D;mn&amp;u&#x3D;http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name&#x3D;tj_login class&#x3D;lb&gt;登录&lt;&#x2F;a&gt; &lt;&#x2F;noscript&gt; &lt;script&gt;document.write(&#39;&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;www.baidu.com&#x2F;bdorz&#x2F;login.gif?login&amp;tpl&#x3D;mn&amp;u&#x3D;&#39;+ encodeURIComponent(window.location.href+ (window.location.search &#x3D;&#x3D;&#x3D; &quot;&quot; ? &quot;?&quot; : &quot;&amp;&quot;)+ &quot;bdorz_come&#x3D;1&quot;)+ &#39;&quot; name&#x3D;&quot;tj_login&quot; class&#x3D;&quot;lb&quot;&gt;登录&lt;&#x2F;a&gt;&#39;);&lt;&#x2F;script&gt; &lt;a href&#x3D;&#x2F;&#x2F;www.baidu.com&#x2F;more&#x2F; name&#x3D;tj_briicon class&#x3D;bri style&#x3D;&quot;display: block;&quot;&gt;更多产品&lt;&#x2F;a&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;div id&#x3D;ftCon&gt; &lt;div id&#x3D;ftConw&gt; &lt;p id&#x3D;lh&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;home.baidu.com&gt;关于百度&lt;&#x2F;a&gt; &lt;a href&#x3D;http:&#x2F;&#x2F;ir.baidu.com&gt;About Baidu&lt;&#x2F;a&gt; &lt;&#x2F;p&gt; &lt;p id&#x3D;cp&gt;&amp;copy;2017&amp;nbsp;Baidu&amp;nbsp;&lt;a href&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;duty&#x2F;&gt;使用百度前必读&lt;&#x2F;a&gt;&amp;nbsp; &lt;a href&#x3D;http:&#x2F;&#x2F;jianyi.baidu.com&#x2F; class&#x3D;cp-feedback&gt;意见反馈&lt;&#x2F;a&gt;&amp;nbsp;京ICP证030173号&amp;nbsp; &lt;img src&#x3D;&#x2F;&#x2F;www.baidu.com&#x2F;img&#x2F;gs.gif&gt; &lt;&#x2F;p&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;&#x2F;body&gt; &lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-模块"><a href="#5-模块" class="headerlink" title="5.模块"></a>5.模块</h3><blockquote>
<p><code>-m &lt;模块名&gt;&lt;参数&gt;</code>使用模块</p>
</blockquote>
<h4 id="A-multiport模块"><a href="#A-multiport模块" class="headerlink" title="A.multiport模块"></a>A.<code>multiport</code>模块</h4><ul>
<li><code>-m multiport</code>指定多个端口<ul>
<li><code>--sports</code>  <code>port1</code>,<code>port2</code>,<code>port3</code>源端口</li>
<li><code>--dports</code>  <code>port1</code>,<code>port2</code>,<code>port3</code>目的端口</li>
</ul>
</li>
</ul>
<h5 id="可以优化一下上面的规则"><a href="#可以优化一下上面的规则" class="headerlink" title="可以优化一下上面的规则"></a>可以优化一下上面的规则</h5><blockquote>
<p><strong>可以发现前面的三条规则，除了端口不一样，其他参数都是一样的，那么就可以调用这个模块</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  0.0.0.0&#x2F;0            192.168.140.14       tcp spt:443
ACCEPT     tcp  --  0.0.0.0&#x2F;0            192.168.140.14       tcp spt:53
ACCEPT     tcp  --  0.0.0.0&#x2F;0            192.168.140.14       tcp spt:80
ACCEPT     udp  --  0.0.0.0&#x2F;0            192.168.140.14       udp spt:53
ACCEPT     tcp  --  192.168.140.1        192.168.140.14       tcp dpt:22
ACCEPT     icmp --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           
ACCEPT     icmp --  0.0.0.0&#x2F;0            192.168.140.14       icmptype 0
DROP       all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="先删除旧的规则"><a href="#先删除旧的规则" class="headerlink" title="先删除旧的规则"></a>先删除旧的规则</h5><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -D INPUT 1
[root@node4 ~]# iptables -t filter -D INPUT 1
[root@node4 ~]# iptables -t filter -D INPUT 1	#执行三遍，当删除第一条的时候，第二条会自动上位变成第一条，以此类推
[root@node4 ~]# iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     udp  --  0.0.0.0&#x2F;0            192.168.140.14       udp spt:53
ACCEPT     tcp  --  192.168.140.1        192.168.140.14       tcp dpt:22
ACCEPT     icmp --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           
ACCEPT     icmp --  0.0.0.0&#x2F;0            192.168.140.14       icmptype 0
DROP       all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="添加规则-1"><a href="#添加规则-1" class="headerlink" title="添加规则"></a>添加规则</h5><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT 2 -d 192.168.140.14 -p tcp -m multiport --sports 53,80,443 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     udp  --  0.0.0.0&#x2F;0            192.168.140.14       udp spt:53
ACCEPT     tcp  --  0.0.0.0&#x2F;0            192.168.140.14       multiport sports 53,80,443
ACCEPT     tcp  --  192.168.140.1        192.168.140.14       tcp dpt:22
ACCEPT     icmp --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           
ACCEPT     icmp --  0.0.0.0&#x2F;0            192.168.140.14       icmptype 0
DROP       all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="B-iprange模块"><a href="#B-iprange模块" class="headerlink" title="B.iprange模块"></a>B.<code>iprange</code>模块</h4><ul>
<li><code>-m iprange</code>指定多个IP地址<ul>
<li><code>--src-range [ip-ip]</code>源地址</li>
<li><code>--dst-range [ip-ip]</code>目的地址</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>允许<code>Windows</code>和<code>node5</code>主机<code>ping</code>通服务器</strong></p>
</blockquote>
<h5 id="添加规则-2"><a href="#添加规则-2" class="headerlink" title="添加规则"></a>添加规则</h5><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT -m iprange --src-range 192.168.140.1-192.168.140.15 -d 192.168.140.14 -p icmp --icmp-type 8 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><pre class="line-numbers language-none"><code class="language-none">C:\Users\wangshengjj&gt;ping 192.168.140.14

正在 Ping 192.168.140.14 具有 32 字节的数据:
来自 192.168.140.14 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64
来自 192.168.140.14 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@node5 ~]# ping 192.168.140.14
PING 192.168.140.14 (192.168.140.14) 56(84) bytes of data.
64 bytes from 192.168.140.14: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.157 ms
64 bytes from 192.168.140.14: icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;0.180 ms
64 bytes from 192.168.140.14: icmp_seq&#x3D;3 ttl&#x3D;64 time&#x3D;0.212 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="C-state状态模块"><a href="#C-state状态模块" class="headerlink" title="C.state状态模块"></a>C.<code>state</code>状态模块</h4><ul>
<li><code>--state</code></li>
<li><code>NEW	</code><ul>
<li>首次访问</li>
</ul>
</li>
<li><code>ESTABLISHED</code><ul>
<li>服务后续所有访问 </li>
<li>响应数据</li>
</ul>
</li>
<li><code>RELATED</code>【FTP】<ul>
<li>相关联的连接</li>
</ul>
</li>
</ul>
<h5 id="a-首次访问和后续访问"><a href="#a-首次访问和后续访问" class="headerlink" title="a.首次访问和后续访问"></a>a.首次访问和后续访问</h5><h6 id="安装httpd软件并启用"><a href="#安装httpd软件并启用" class="headerlink" title="安装httpd软件并启用"></a>安装<code>httpd</code>软件并启用</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# yum install -y httpd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# systemctl enable --now httpd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="编写防火墙规则"><a href="#编写防火墙规则" class="headerlink" title="编写防火墙规则"></a>编写防火墙规则</h6><blockquote>
<p><strong>允许所有客户端首次访问和后续所有访问</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="Windows测试-2"><a href="#Windows测试-2" class="headerlink" title="Windows测试"></a><code>Windows</code>测试</h6><p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall02.png" alt="wall02"></p>
<h5 id="b-相关联的连接-FTP为例子"><a href="#b-相关联的连接-FTP为例子" class="headerlink" title="b.相关联的连接(FTP为例子)"></a>b.相关联的连接(FTP为例子)</h5><h6 id="安装FTP软件并启用"><a href="#安装FTP软件并启用" class="headerlink" title="安装FTP软件并启用"></a>安装FTP软件并启用</h6><blockquote>
<p><strong>关于<code>FTP</code>服务教程：<a target="_blank" rel="noopener" href="https://www.wsjj.top/archives/61">https://www.wsjj.top/archives/61</a></strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# yum install -y vsftpd
[root@node4 ~]# systemctl enable --now vsftpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h6 id="随便放几个测试文件"><a href="#随便放几个测试文件" class="headerlink" title="随便放几个测试文件"></a>随便放几个测试文件</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# touch &#x2F;var&#x2F;ftp&#x2F;&#123;1..5&#125;.jpg
[root@node4 ~]# touch &#x2F;var&#x2F;ftp&#x2F;&#123;1..5&#125;.mp3
[root@node4 ~]# ls &#x2F;var&#x2F;ftp&#x2F;
1.jpg  1.mp3  2.jpg  2.mp3  3.jpg  3.mp3  4.jpg  4.mp3  5.jpg  5.mp3  pub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="先释放TCP协议21号端口"><a href="#先释放TCP协议21号端口" class="headerlink" title="先释放TCP协议21号端口"></a>先释放<code>TCP</code>协议<code>21</code>号端口</h6><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -p tcp --dport 21 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="使用node5连接FTP服务器"><a href="#使用node5连接FTP服务器" class="headerlink" title="使用node5连接FTP服务器"></a>使用<code>node5</code>连接<code>FTP</code>服务器</h6><pre class="line-numbers language-none"><code class="language-none">[root@node5 ~]# yum install -y ftp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@node5 ~]# ftp 192.168.140.14
Connected to 192.168.140.14 (192.168.140.14).
220 (vsFTPd 3.0.2)
Name (192.168.140.14:root): ftp	#默认匿名用户是ftp
331 Please specify the password.
Password:	#没有密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>关于<code>FTP</code>的默认行为</strong><br><strong>使用<code>21</code>号端口传输命令，大于<code>1024</code>以上的随机端口传输数据</strong><br><strong>我们并没有开放相应的端口，所以看不到数据</strong><br><strong>但是开放<code>1024</code>以上的所有端口，并不合理</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">ftp&gt; ls
227 Entering Passive Mode (192,168,140,14,199,133).
ftp: connect: 连接超时	#没有数据的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="回到服务器配置防火墙规则"><a href="#回到服务器配置防火墙规则" class="headerlink" title="回到服务器配置防火墙规则"></a>回到服务器配置防火墙规则</h6><blockquote>
<p><strong>还是<code>FTP</code>默认行为</strong><br>每<strong>次执行命令后，<code>FTP</code>给我们返回结果的时候，每一次使用的端口都是大于<code>1024</code>以上的随机端口</strong><br><strong>所以除了授权&#x3D;&#x3D;相关连的连接&#x3D;&#x3D;，还要保持&#x3D;&#x3D;后续的连接&#x3D;&#x3D;</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -I INPUT -d 192.168.140.14 -m state --state RELATED,ESTABLISHED -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="临时加载内核模块"><a href="#临时加载内核模块" class="headerlink" title="临时加载内核模块"></a>临时加载内核模块</h6><blockquote>
<p><strong>没错，放行了相应的规则也不行</strong><br><strong>还需要让<code>Linux</code>系统加载模块</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# modprobe ip_nat_ftp
[root@node4 ~]# modprobe ip_conntrack_ftp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h6 id="回到node5测试"><a href="#回到node5测试" class="headerlink" title="回到node5测试"></a>回到<code>node5</code>测试</h6><pre class="line-numbers language-none"><code class="language-none">[root@node5 ~]# ftp 192.168.140.14
Connected to 192.168.140.14 (192.168.140.14).
220 (vsFTPd 3.0.2)
Name (192.168.140.14:root): ftp
331 Please specify the password.
Password:
230 Login successful.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>这次终于看到了，我们想要的数据</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">ftp&gt; ls
227 Entering Passive Mode (192,168,140,14,165,81).
150 Here comes the directory listing.
-rw-r--r--    1 0        0               0 May 24 12:35 1.jpg
-rw-r--r--    1 0        0               0 May 24 12:35 1.mp3
-rw-r--r--    1 0        0               0 May 24 12:35 2.jpg
-rw-r--r--    1 0        0               0 May 24 12:35 2.mp3
-rw-r--r--    1 0        0               0 May 24 12:35 3.jpg
-rw-r--r--    1 0        0               0 May 24 12:35 3.mp3
-rw-r--r--    1 0        0               0 May 24 12:35 4.jpg
-rw-r--r--    1 0        0               0 May 24 12:35 4.mp3
-rw-r--r--    1 0        0               0 May 24 12:35 5.jpg
-rw-r--r--    1 0        0               0 May 24 12:35 5.mp3
drwxr-xr-x    2 0        0               6 Jun 09  2021 pub
226 Directory send OK.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-保存、恢复规则"><a href="#6-保存、恢复规则" class="headerlink" title="6.保存、恢复规则"></a>6.保存、恢复规则</h3><blockquote>
<p><strong>默认防火墙规则都是临时的，重启以后失效</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables-save &gt; &#x2F;opt&#x2F;iptables.rules
[root@node4 ~]# iptables-restore &lt; &#x2F;opt&#x2F;iptables.rules <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="7-修改规则"><a href="#7-修改规则" class="headerlink" title="7.修改规则"></a>7.修改规则</h3><ul>
<li><code>-R</code>修改规则</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -R INPUT 2 -s 192.168.140.11 -d 192.168.140.14 -p tcp -m multiport --dports 3306,22 -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="8-修改默认规则"><a href="#8-修改默认规则" class="headerlink" title="8.修改默认规则"></a>8.修改默认规则</h3><p><strong><code>-P</code>修改默认规则</strong></p>
<blockquote>
<p><strong><code>iptables</code>默认的链规则是允许</strong></p>
</blockquote>
<h4 id="A-命令格式-1"><a href="#A-命令格式-1" class="headerlink" title="A.命令格式"></a>A.命令格式</h4><pre class="line-numbers language-none"><code class="language-none">iptables -t &lt;表名&gt; -P &lt;链名&gt; &lt;行为&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="行为-1"><a href="#行为-1" class="headerlink" title="行为"></a>行为</h5><ul>
<li><code>ACCEPT</code>允许</li>
<li><code>DROP</code>拒绝</li>
<li><code>REJECT</code>拒绝</li>
</ul>
<h4 id="B-修改默认output链，默认允许改为拒绝"><a href="#B-修改默认output链，默认允许改为拒绝" class="headerlink" title="B.修改默认output链，默认允许改为拒绝"></a>B.修改默认output链，默认允许改为拒绝</h4><blockquote>
<p><strong>请确保已经添加的<code>SSH</code>出口规则！</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -t filter -A OUTPUT -p tcp --sport 22 -j ACCEPT	#出口允许22号端口
[root@node4 ~]# iptables -P OUTPUT DROP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="C-再次查看规则"><a href="#C-再次查看规则" class="headerlink" title="C.再次查看规则"></a>C.再次查看规则</h4><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -nL
Chain OUTPUT (policy DROP)	#这里的默认行为已经变更为拒绝
target     prot opt source               destination         
ACCEPT     tcp  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            tcp spt:22<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# ping baidu.com
ping: baidu.com: 未知的名称或服务	#已经断网了

[root@node4 ~]# ping 114.114.114.114
PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.
ping: sendmsg: 不允许的操作
ping: sendmsg: 不允许的操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="D-恢复默认允许策略"><a href="#D-恢复默认允许策略" class="headerlink" title="D.恢复默认允许策略"></a>D.恢复默认允许策略</h4><pre class="line-numbers language-none"><code class="language-none">[root@node4 ~]# iptables -P OUTPUT ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="五、NAT表管理"><a href="#五、NAT表管理" class="headerlink" title="五、NAT表管理"></a>五、NAT表管理</h2><h3 id="1-NAT的工作原理"><a href="#1-NAT的工作原理" class="headerlink" title="1.NAT的工作原理"></a>1.<code>NAT</code>的工作原理</h3><p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall03.png" alt="wall03"></p>
<ul>
<li>转换源<code>IP</code>地址<ul>
<li><code>-j SNAT --to-source &lt;公网地址&gt;</code></li>
<li><code>-j MASQUERADE</code></li>
</ul>
</li>
<li>转换目的<code>IP</code>地址<ul>
<li><code>-j DNAT --to-destination &lt;内网地址&gt;</code></li>
</ul>
</li>
</ul>
<h3 id="2-SNAT源地址转换"><a href="#2-SNAT源地址转换" class="headerlink" title="2.SNAT源地址转换"></a>2.<code>SNAT</code>源地址转换</h3><blockquote>
<p><strong>作用: 普通主机可以访问互联网</strong><br><strong>正常，&#x3D;&#x3D;内网IP&#x3D;&#x3D;是无法直接&#x3D;&#x3D;访问互联网&#x3D;&#x3D;的，都是通过<code>NAT</code>的网络地址转换技术，把我们的&#x3D;&#x3D;内网IP&#x3D;&#x3D;地址临时转换成&#x3D;&#x3D;公网IP&#x3D;&#x3D;。</strong><br><strong>这一点，有点像家用的路由器一样，它会自动的把我们的内网<code>IP</code>转换成拨号上号的那个公网<code>IP</code></strong></p>
</blockquote>
<p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall04.png" alt="wall04"></p>
<h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>client.linux.com</td>
<td>192.168.233.10</td>
<td>模拟客户端</td>
</tr>
<tr>
<td>nat.linux.com</td>
<td>192.168.233.100、30.30.30.128</td>
<td>模拟NAT</td>
</tr>
<tr>
<td>server.linux.com</td>
<td>30.30.30.10</td>
<td>模拟公网服务器</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>在配置之前，请提前准备好<code>httpd</code>的服务</strong></p>
</blockquote>
<h5 id="A-先给NAT主机添加一块网卡"><a href="#A-先给NAT主机添加一块网卡" class="headerlink" title="A.先给NAT主机添加一块网卡"></a>A.先给NAT主机添加一块网卡</h5><p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall05.png" alt="wall05"></p>
<h5 id="B-修改另外2台主机的网卡"><a href="#B-修改另外2台主机的网卡" class="headerlink" title="B.修改另外2台主机的网卡"></a>B.修改另外2台主机的网卡</h5><p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall06.png" alt="wall06"></p>
<p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall07.png" alt="wall07"></p>
<h5 id="C-配置IP地址和网关地址"><a href="#C-配置IP地址和网关地址" class="headerlink" title="C.配置IP地址和网关地址"></a>C.配置IP地址和网关地址</h5><pre class="line-numbers language-none"><code class="language-none">[root@client ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33
TYPE&#x3D;&quot;Ethernet&quot;
BROWSER_ONLY&#x3D;&quot;no&quot;
BOOTPROTO&#x3D;&quot;none&quot;
DEFROUTE&#x3D;&quot;yes&quot;
NAME&#x3D;&quot;ens33&quot;
DEVICE&#x3D;&quot;ens33&quot;
ONBOOT&#x3D;&quot;yes&quot;
ETHTOOL_OPTS&#x3D;&quot;autoneg on&quot;
IPADDR&#x3D;192.168.233.10
NETMASK&#x3D;255.255.255.0
GATEWAY&#x3D;192.168.233.100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@nat ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33
TYPE&#x3D;&quot;Ethernet&quot;
BROWSER_ONLY&#x3D;&quot;no&quot;
BOOTPROTO&#x3D;&quot;none&quot;
DEFROUTE&#x3D;&quot;yes&quot;
NAME&#x3D;&quot;ens33&quot;
DEVICE&#x3D;&quot;ens33&quot;
ONBOOT&#x3D;&quot;yes&quot;
ETHTOOL_OPTS&#x3D;&quot;autoneg on&quot;
IPADDR&#x3D;192.168.233.100
#NETMASK&#x3D;255.255.255.0
#GATEWAY&#x3D;192.168.140.2
#DNS1&#x3D;114.114.114.114
#DNS2&#x3D;8.8.8.8
[root@nat ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens36
TYPE&#x3D;&quot;Ethernet&quot;
BROWSER_ONLY&#x3D;&quot;no&quot;
BOOTPROTO&#x3D;&quot;none&quot;
DEFROUTE&#x3D;&quot;yes&quot;
NAME&#x3D;&quot;ens33&quot;
DEVICE&#x3D;&quot;ens33&quot;
ONBOOT&#x3D;&quot;yes&quot;
ETHTOOL_OPTS&#x3D;&quot;autoneg on&quot;
IPADDR&#x3D;30.30.30.128<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@server ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33
TYPE&#x3D;&quot;Ethernet&quot;
BROWSER_ONLY&#x3D;&quot;no&quot;
BOOTPROTO&#x3D;&quot;none&quot;
DEFROUTE&#x3D;&quot;yes&quot;
NAME&#x3D;&quot;ens33&quot;
DEVICE&#x3D;&quot;ens33&quot;
ONBOOT&#x3D;&quot;yes&quot;
ETHTOOL_OPTS&#x3D;&quot;autoneg on&quot;
IPADDR&#x3D;30.30.30.10
NETMASK&#x3D;255.255.255.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="D-在服务器上发布测试网页"><a href="#D-在服务器上发布测试网页" class="headerlink" title="D.在服务器上发布测试网页"></a>D.在服务器上发布测试网页</h5><pre class="line-numbers language-none"><code class="language-none">[root@server ~]# rm -rf &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;welcome.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@server ~]# echo &quot;&lt;h1&gt;30.30.30.10 webserver&lt;&#x2F;h1&gt;&quot; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;index.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@server ~]# systemctl enable --now httpd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="E-配置NAT"><a href="#E-配置NAT" class="headerlink" title="E.配置NAT"></a>E.配置NAT</h5><blockquote>
<p><strong>先修改内核参数，开启路由地址转发功能</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@nat ~]# sed -ri &#39;$a \net.ipv4.ip_forward &#x3D; 1&#39; &#x2F;etc&#x2F;sysctl.conf
[root@nat ~]# sysctl -p
net.ipv4.ip_forward &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="添加到规则到防火墙"><a href="#添加到规则到防火墙" class="headerlink" title="添加到规则到防火墙"></a>添加到规则到防火墙</h6><blockquote>
<p><strong>指定网段的所有请求，都会被<code>NAT</code>转换成<code>Wan</code>口的<code>IP</code>也就是<code>30.30.30.128</code></strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@nat ~]# iptables -t nat -A POSTROUTING -s 192.168.233.0&#x2F;24 -j SNAT --to-source 30.30.30.128<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>或</strong></p>
<blockquote>
<p><strong>指定网段的所有请求，都会被<code>NAT</code>自动转换成<code>Wan</code>口的<code>IP</code></strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@nat ~]# iptables -t nat -A POSTROUTING -s 192.168.233.0&#x2F;24 -j MASQUERADE<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">[root@nat ~]# iptables -t nat -nL -v
Chain PREROUTING (policy ACCEPT 5 packets, 300 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    5   300 MASQUERADE  all  --  *      *       192.168.233.0&#x2F;24     0.0.0.0&#x2F;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="F-客户端测试访问"><a href="#F-客户端测试访问" class="headerlink" title="F.客户端测试访问"></a>F.客户端测试访问</h5><pre class="line-numbers language-none"><code class="language-none">[root@client ~]# curl 30.30.30.10
&lt;h1&gt;30.30.30.10 webserver&lt;&#x2F;h1&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>可以查看<code>server</code>端的访问日志</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@server ~]# tail -f &#x2F;var&#x2F;log&#x2F;httpd&#x2F;access_log
30.30.30.128 - - [29&#x2F;May&#x2F;2023:14:18:35 +0800] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 31 &quot;-&quot; &quot;curl&#x2F;7.29.0&quot;
30.30.30.128 - - [29&#x2F;May&#x2F;2023:14:20:50 +0800] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 31 &quot;-&quot; &quot;curl&#x2F;7.29.0&quot;
30.30.30.128 - - [29&#x2F;May&#x2F;2023:14:20:50 +0800] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 31 &quot;-&quot; &quot;curl&#x2F;7.29.0&quot;
30.30.30.128 - - [29&#x2F;May&#x2F;2023:14:20:51 +0800] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 31 &quot;-&quot; &quot;curl&#x2F;7.29.0&quot;
30.30.30.128 - - [29&#x2F;May&#x2F;2023:14:20:52 +0800] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 31 &quot;-&quot; &quot;curl&#x2F;7.29.0&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>这个<code>IP</code>很明显是<code>NAT</code>上的<code>wan</code>口<code>IP</code>，相对于<code>client</code>端就是他的公网<code>IP</code></strong></p>
</blockquote>
<h3 id="3-DNAT发布服务-端口映射"><a href="#3-DNAT发布服务-端口映射" class="headerlink" title="3.DNAT发布服务(端口映射)"></a>3.<code>DNAT</code>发布服务(端口映射)</h3><p><img src="/medias/loading.gif" data-original="https://www.wsjj.top/upload/2023/05/wall08.png" alt="wall08"></p>
<h4 id="实验-1"><a href="#实验-1" class="headerlink" title="实验"></a>实验</h4><blockquote>
<p><strong>模拟公网客户端，访问内网的服务器</strong><br><strong>注意：<code>NAT</code>上面<code>wan口</code>绑定的<code>IP</code>必须是<code>公网IP</code></strong><br><strong>端口映射的端口不可以冲突！</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>server.linux.com</td>
<td>192.168.233.10</td>
<td>模拟服务端</td>
</tr>
<tr>
<td>nat.linux.com</td>
<td>192.168.233.100、30.30.30.128</td>
<td>模拟NAT</td>
</tr>
<tr>
<td>client.linux.com</td>
<td>30.30.30.10</td>
<td>模拟客户端</td>
</tr>
</tbody></table>
<h5 id="A-服务端发布测试页面"><a href="#A-服务端发布测试页面" class="headerlink" title="A.服务端发布测试页面"></a>A.服务端发布测试页面</h5><pre class="line-numbers language-none"><code class="language-none">[root@client ~]# rm -rf &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;welcome.conf
[root@client ~]# echo &quot;192.168.233.10 webserver&quot; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;index.html
[root@client ~]# systemctl enable --now httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="B-公网客户端测试"><a href="#B-公网客户端测试" class="headerlink" title="B.公网客户端测试"></a>B.公网客户端测试</h5><pre class="line-numbers language-none"><code class="language-none">[root@server ~]# curl 30.30.30.128	#这是正常现象，我们还没有做端口映射
curl: (7) Failed connect to 30.30.30.128:80; 拒绝连接<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="C-回到NAT服务器，配置防火墙策略"><a href="#C-回到NAT服务器，配置防火墙策略" class="headerlink" title="C.回到NAT服务器，配置防火墙策略"></a>C.回到NAT服务器，配置防火墙策略</h5><blockquote>
<p><strong>把内网<code>192.168.233.10</code>上的<code>80</code>端口，映射到公网<code>30.30.30.128</code>的<code>8080</code>端口</strong></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@nat ~]# iptables -t nat -I PREROUTING -d 30.30.30.128 -p tcp --dport 8080 -j DNAT --to-destination 192.168.233.10:80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="D-再次测试"><a href="#D-再次测试" class="headerlink" title="D.再次测试"></a>D.再次测试</h5><pre class="line-numbers language-none"><code class="language-none">[root@server ~]# curl 30.30.30.128:8080	#这次访问正常了
192.168.233.10 webserver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.wangshengjj.work">网笙久久</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.wangshengjj.work/2023/05/24/124/">https://blog.wangshengjj.work/2023/05/24/124/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.wangshengjj.work" target="_blank">WangShengJJのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/centos/">centos</a><a class="post-meta__tags" href="/tags/centos7/">centos7</a><a class="post-meta__tags" href="/tags/iptables/">iptables</a><a class="post-meta__tags" href="/tags/linux%E9%98%B2%E7%81%AB%E5%A2%99/">linux防火墙</a></div><div class="post_share"><div class="social-share" data-image="https://www.dmoe.cc/random.php" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/26/kernel/" title="Centos7升级内核版本教程"><img class="cover" src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Centos7升级内核版本教程</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/24/123/" title="【Linux安全系列教程】sudo授权机制"><img class="cover" src="/medias/loading.gif" data-original="https://api.ghser.com/random/api.php" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【Linux安全系列教程】sudo授权机制</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/05/24/123/" title="【Linux安全系列教程】sudo授权机制"><img class="cover" src="/medias/loading.gif" data-original="https://api.ghser.com/random/api.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-24</div><div class="title">【Linux安全系列教程】sudo授权机制</div></div></a></div><div><a href="/2023/05/29/125/" title="【Linux安全系列教程】Firewalld防火墙"><img class="cover" src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-29</div><div class="title">【Linux安全系列教程】Firewalld防火墙</div></div></a></div><div><a href="/2023/05/31/129/" title="【虚拟化应用系列教程】KVM网络管理"><img class="cover" src="/medias/loading.gif" data-original="https://api.ghser.com/random/api.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-31</div><div class="title">【虚拟化应用系列教程】KVM网络管理</div></div></a></div><div><a href="/2023/05/30/128/" title="【虚拟化应用系列教程】KVM虚拟机管理"><img class="cover" src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-30</div><div class="title">【虚拟化应用系列教程】KVM虚拟机管理</div></div></a></div><div><a href="/2023/05/26/kernel/" title="Centos7升级内核版本教程"><img class="cover" src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-26</div><div class="title">Centos7升级内核版本教程</div></div></a></div><div><a href="/2023/05/12/113/" title="【Zabbix系列教程】自动发现和自动注册"><img class="cover" src="/medias/loading.gif" data-original="https://api.ghser.com/random/api.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-12</div><div class="title">【Zabbix系列教程】自动发现和自动注册</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/medias/loading.gif" data-original="https://www.wangshengjj.work/upload/2022/10/touxiang.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">网笙久久</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">185</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">261</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wangshengjj"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wangshengjj" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wangshengjj@wangshengjj.work" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.wangshengjj.work" target="_blank" title="Blog"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到网笙久久的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%80%90Linux%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%E3%80%91iptables%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.</span> <span class="toc-text">【Linux安全系列教程】iptables防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一、防火墙的类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">二、防火墙的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%85%B3%E4%BA%8E%E5%9B%9B%E8%A1%A8%E4%BA%94%E9%93%BE"><span class="toc-number">1.3.</span> <span class="toc-text">三、关于四表五链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-filler%E8%A1%A8%E4%B8%AD%E7%9A%84%E9%93%BE"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.filler表中的链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NAT%E8%A1%A8%E4%B8%AD%E7%9A%84%E9%93%BE"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.NAT表中的链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-mangle%E8%A1%A8%E4%B8%AD%E7%9A%84%E9%93%BE"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.mangle表中的链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-raw%E8%A1%A8%E4%B8%AD%E7%9A%84%E9%93%BE"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.raw表中的链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.3.5.</span> <span class="toc-text">编写规则注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4%E8%A7%84%E5%88%99%E7%AE%A1%E7%90%86-filter%E8%A1%A8"><span class="toc-number">1.4.</span> <span class="toc-text">四、数据过滤规则管理(filter表)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.关闭防火墙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.查看防火墙规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E6%9F%A5%E7%9C%8B%E8%A7%84%E5%88%99"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">A.查看规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#t-lt-%E8%A1%A8%E5%90%8D-gt-%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E8%A1%A8%E8%A7%84%E5%88%99"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">-t&lt;表名&gt;查看指定表规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#line-number%E6%98%BE%E7%A4%BA%E8%A1%8C%E5%8F%B7"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">--line-number显示行号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#v%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">-v查看详细信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%A0%E9%99%A4%E8%A7%84%E5%88%99"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.删除规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E5%88%A0%E9%99%A4%E5%8D%95%E6%9D%A1%E8%A7%84%E5%88%99"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">A.删除单条规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.4.3.1.1.</span> <span class="toc-text">命令格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%A7%84%E5%88%99"><span class="toc-number">1.4.3.1.2.</span> <span class="toc-text">查看所有规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%8B%EF%BC%9A%E6%88%91%E6%83%B3%E5%88%A0%E9%99%A4%E7%AC%AC2%E6%9D%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.3.1.3.</span> <span class="toc-text">例：我想删除第2条数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%84%E5%88%99"><span class="toc-number">1.4.3.1.4.</span> <span class="toc-text">查看规则</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E8%A7%84%E5%88%99"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">B.删除所有规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%84%E5%88%99-1"><span class="toc-number">1.4.3.2.1.</span> <span class="toc-text">查看规则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.添加规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">A.命令格式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA"><span class="toc-number">1.4.4.1.1.</span> <span class="toc-text">行为</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%95%B0%E6%8D%AE%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">1.4.4.1.2.</span> <span class="toc-text">匹配数据条件的常用选项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">B.几个例子</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a-%E4%BB%85%E5%85%81%E8%AE%B8Windows%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84ssh%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%8B%92%E7%BB%9D%E5%85%B6%E4%BB%96%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.4.2.1.</span> <span class="toc-text">a.仅允许Windows访问服务器上的ssh服务，并且拒绝其他所有服务</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%85%B6%E4%BB%96%E6%9C%BA%E5%99%A8%E8%83%BD%E5%90%A6%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.4.4.2.1.1.</span> <span class="toc-text">测试其他机器能否通过SSH连接服务器</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b-%E4%BB%85%E5%85%81%E8%AE%B8Windows%E5%8F%AF%E4%BB%A5ping%E9%80%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E6%8B%92%E7%BB%9D%E5%85%B6%E4%BB%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.4.2.2.</span> <span class="toc-text">b.仅允许Windows可以ping通服务器，拒绝其他连接</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%84%E5%88%99"><span class="toc-number">1.4.4.2.2.1.</span> <span class="toc-text">查询规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Windows%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.4.2.2.2.</span> <span class="toc-text">Windows测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c-%E5%85%81%E8%AE%B8%E6%9C%8D%E5%8A%A1%E5%99%A8ping%E9%80%9A%E5%85%B6%E4%BB%96%E4%B8%BB%E6%9C%BA%EF%BC%8C%E8%80%8C%E5%85%B6%E4%BB%96%E4%B8%BB%E6%9C%BA-%E6%AF%94%E5%A6%82Windows-%E6%97%A0%E6%B3%95ping%E9%80%9A%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.4.4.2.3.</span> <span class="toc-text">c.允许服务器ping通其他主机，而其他主机(比如Windows)无法ping通服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B9%8B%E5%89%8D%E7%9A%84ping%E8%A7%84%E5%88%99"><span class="toc-number">1.4.4.2.3.1.</span> <span class="toc-text">删除之前的ping规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%A7%84%E5%88%99"><span class="toc-number">1.4.4.2.3.2.</span> <span class="toc-text">新增规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Windows%E6%B5%8B%E8%AF%95-1"><span class="toc-number">1.4.4.2.3.3.</span> <span class="toc-text">Windows测试</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%99%E8%BE%B9%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.4.2.3.4.</span> <span class="toc-text">服务器这边测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#d-%E8%A6%81%E6%B1%82%E8%83%BDping%E9%80%9A%E8%87%AA%E5%B7%B1"><span class="toc-number">1.4.4.2.4.</span> <span class="toc-text">d.要求能ping通自己</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99"><span class="toc-number">1.4.4.2.4.1.</span> <span class="toc-text">添加规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%A7%84%E5%88%99-1"><span class="toc-number">1.4.4.2.4.2.</span> <span class="toc-text">查看所有规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ping%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.4.2.4.3.</span> <span class="toc-text">ping测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#e-%E8%A6%81%E6%B1%82%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E4%B8%8A%E7%BD%91%EF%BC%8C%E6%AF%94%E5%A6%82%E8%AE%BF%E9%97%AEbaidu"><span class="toc-number">1.4.4.2.5.</span> <span class="toc-text">e.要求服务器可以正常上网，比如访问baidu</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99%EF%BC%8C%E5%85%88%E8%83%BDping%E9%80%9A"><span class="toc-number">1.4.4.2.5.1.</span> <span class="toc-text">添加规则，先能ping通</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95ping%E9%80%9Abaidu"><span class="toc-number">1.4.4.2.5.2.</span> <span class="toc-text">测试ping通baidu</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%A7%E7%BB%AD%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%AE%BF%E9%97%AEweb%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.4.2.5.3.</span> <span class="toc-text">继续添加规则，用于访问web服务</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8curl%E5%91%BD%E4%BB%A4%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.4.2.5.4.</span> <span class="toc-text">使用curl命令测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.5.</span> <span class="toc-text">5.模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-multiport%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">A.multiport模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E4%BC%98%E5%8C%96%E4%B8%80%E4%B8%8B%E4%B8%8A%E9%9D%A2%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.4.5.1.1.</span> <span class="toc-text">可以优化一下上面的规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%88%E5%88%A0%E9%99%A4%E6%97%A7%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.4.5.1.2.</span> <span class="toc-text">先删除旧的规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99-1"><span class="toc-number">1.4.5.1.3.</span> <span class="toc-text">添加规则</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-iprange%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">B.iprange模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99-2"><span class="toc-number">1.4.5.2.1.</span> <span class="toc-text">添加规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.5.2.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-state%E7%8A%B6%E6%80%81%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">C.state状态模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a-%E9%A6%96%E6%AC%A1%E8%AE%BF%E9%97%AE%E5%92%8C%E5%90%8E%E7%BB%AD%E8%AE%BF%E9%97%AE"><span class="toc-number">1.4.5.3.1.</span> <span class="toc-text">a.首次访问和后续访问</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85httpd%E8%BD%AF%E4%BB%B6%E5%B9%B6%E5%90%AF%E7%94%A8"><span class="toc-number">1.4.5.3.1.1.</span> <span class="toc-text">安装httpd软件并启用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="toc-number">1.4.5.3.1.2.</span> <span class="toc-text">编写防火墙规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Windows%E6%B5%8B%E8%AF%95-2"><span class="toc-number">1.4.5.3.1.3.</span> <span class="toc-text">Windows测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b-%E7%9B%B8%E5%85%B3%E8%81%94%E7%9A%84%E8%BF%9E%E6%8E%A5-FTP%E4%B8%BA%E4%BE%8B%E5%AD%90"><span class="toc-number">1.4.5.3.2.</span> <span class="toc-text">b.相关联的连接(FTP为例子)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85FTP%E8%BD%AF%E4%BB%B6%E5%B9%B6%E5%90%AF%E7%94%A8"><span class="toc-number">1.4.5.3.2.1.</span> <span class="toc-text">安装FTP软件并启用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9A%8F%E4%BE%BF%E6%94%BE%E5%87%A0%E4%B8%AA%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.5.3.2.2.</span> <span class="toc-text">随便放几个测试文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%88%E9%87%8A%E6%94%BETCP%E5%8D%8F%E8%AE%AE21%E5%8F%B7%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.4.5.3.2.3.</span> <span class="toc-text">先释放TCP协议21号端口</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8node5%E8%BF%9E%E6%8E%A5FTP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.4.5.3.2.4.</span> <span class="toc-text">使用node5连接FTP服务器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%9E%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="toc-number">1.4.5.3.2.5.</span> <span class="toc-text">回到服务器配置防火墙规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E5%8A%A0%E8%BD%BD%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.5.3.2.6.</span> <span class="toc-text">临时加载内核模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%9E%E5%88%B0node5%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.5.3.2.7.</span> <span class="toc-text">回到node5测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BF%9D%E5%AD%98%E3%80%81%E6%81%A2%E5%A4%8D%E8%A7%84%E5%88%99"><span class="toc-number">1.4.6.</span> <span class="toc-text">6.保存、恢复规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%BF%AE%E6%94%B9%E8%A7%84%E5%88%99"><span class="toc-number">1.4.7.</span> <span class="toc-text">7.修改规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-number">1.4.8.</span> <span class="toc-text">8.修改默认规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F-1"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">A.命令格式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA-1"><span class="toc-number">1.4.8.1.1.</span> <span class="toc-text">行为</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4output%E9%93%BE%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%85%81%E8%AE%B8%E6%94%B9%E4%B8%BA%E6%8B%92%E7%BB%9D"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">B.修改默认output链，默认允许改为拒绝</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-%E5%86%8D%E6%AC%A1%E6%9F%A5%E7%9C%8B%E8%A7%84%E5%88%99"><span class="toc-number">1.4.8.3.</span> <span class="toc-text">C.再次查看规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#D-%E6%81%A2%E5%A4%8D%E9%BB%98%E8%AE%A4%E5%85%81%E8%AE%B8%E7%AD%96%E7%95%A5"><span class="toc-number">1.4.8.4.</span> <span class="toc-text">D.恢复默认允许策略</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81NAT%E8%A1%A8%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">五、NAT表管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NAT%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.NAT的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SNAT%E6%BA%90%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.SNAT源地址转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">实验</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#A-%E5%85%88%E7%BB%99NAT%E4%B8%BB%E6%9C%BA%E6%B7%BB%E5%8A%A0%E4%B8%80%E5%9D%97%E7%BD%91%E5%8D%A1"><span class="toc-number">1.5.2.1.1.</span> <span class="toc-text">A.先给NAT主机添加一块网卡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-%E4%BF%AE%E6%94%B9%E5%8F%A6%E5%A4%962%E5%8F%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%BD%91%E5%8D%A1"><span class="toc-number">1.5.2.1.2.</span> <span class="toc-text">B.修改另外2台主机的网卡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#C-%E9%85%8D%E7%BD%AEIP%E5%9C%B0%E5%9D%80%E5%92%8C%E7%BD%91%E5%85%B3%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.2.1.3.</span> <span class="toc-text">C.配置IP地址和网关地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#D-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%8F%91%E5%B8%83%E6%B5%8B%E8%AF%95%E7%BD%91%E9%A1%B5"><span class="toc-number">1.5.2.1.4.</span> <span class="toc-text">D.在服务器上发布测试网页</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#E-%E9%85%8D%E7%BD%AENAT"><span class="toc-number">1.5.2.1.5.</span> <span class="toc-text">E.配置NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0%E8%A7%84%E5%88%99%E5%88%B0%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.5.2.1.5.1.</span> <span class="toc-text">添加到规则到防火墙</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#F-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95%E8%AE%BF%E9%97%AE"><span class="toc-number">1.5.2.1.6.</span> <span class="toc-text">F.客户端测试访问</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-DNAT%E5%8F%91%E5%B8%83%E6%9C%8D%E5%8A%A1-%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">1.5.3.</span> <span class="toc-text">3.DNAT发布服务(端口映射)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-1"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">实验</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#A-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%91%E5%B8%83%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.5.3.1.1.</span> <span class="toc-text">A.服务端发布测试页面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-%E5%85%AC%E7%BD%91%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.3.1.2.</span> <span class="toc-text">B.公网客户端测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#C-%E5%9B%9E%E5%88%B0NAT%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99%E7%AD%96%E7%95%A5"><span class="toc-number">1.5.3.1.3.</span> <span class="toc-text">C.回到NAT服务器，配置防火墙策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#D-%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.3.1.4.</span> <span class="toc-text">D.再次测试</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/02/132/" title="【容器应用系列教程】容器介绍、Docker的安装和基本操作"><img src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【容器应用系列教程】容器介绍、Docker的安装和基本操作"/></a><div class="content"><a class="title" href="/2023/06/02/132/" title="【容器应用系列教程】容器介绍、Docker的安装和基本操作">【容器应用系列教程】容器介绍、Docker的安装和基本操作</a><time datetime="2023-06-02T02:59:37.570Z" title="发表于 2023-06-02 10:59:37">2023-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/01/131/" title="【虚拟化应用系列教程】OpenStack组件"><img src="/medias/loading.gif" data-original="https://api.ghser.com/random/api.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【虚拟化应用系列教程】OpenStack组件"/></a><div class="content"><a class="title" href="/2023/06/01/131/" title="【虚拟化应用系列教程】OpenStack组件">【虚拟化应用系列教程】OpenStack组件</a><time datetime="2023-06-01T09:41:14.757Z" title="发表于 2023-06-01 17:41:14">2023-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/31/130/" title="【虚拟化应用系列教程】KVM存储管理"><img src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【虚拟化应用系列教程】KVM存储管理"/></a><div class="content"><a class="title" href="/2023/05/31/130/" title="【虚拟化应用系列教程】KVM存储管理">【虚拟化应用系列教程】KVM存储管理</a><time datetime="2023-05-31T07:33:09.421Z" title="发表于 2023-05-31 15:33:09">2023-05-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/31/129/" title="【虚拟化应用系列教程】KVM网络管理"><img src="/medias/loading.gif" data-original="https://api.ghser.com/random/api.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【虚拟化应用系列教程】KVM网络管理"/></a><div class="content"><a class="title" href="/2023/05/31/129/" title="【虚拟化应用系列教程】KVM网络管理">【虚拟化应用系列教程】KVM网络管理</a><time datetime="2023-05-31T05:20:18.393Z" title="发表于 2023-05-31 13:20:18">2023-05-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/30/128/" title="【虚拟化应用系列教程】KVM虚拟机管理"><img src="/medias/loading.gif" data-original="https://www.dmoe.cc/random.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【虚拟化应用系列教程】KVM虚拟机管理"/></a><div class="content"><a class="title" href="/2023/05/30/128/" title="【虚拟化应用系列教程】KVM虚拟机管理">【虚拟化应用系列教程】KVM虚拟机管理</a><time datetime="2023-05-30T10:46:29.825Z" title="发表于 2023-05-30 18:46:29">2023-05-30</time></div></div></div></div></div></div></main><footer id="footer" style="background: flase"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By 网笙久久</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=(n.imageLazyLoadSetting.preloadRatio,Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>